<!DOCTYPE html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />

  <title>MVC框架与Backbone.js -- JavaScript 标准参考教程（alpha）</title>
  
  <!-- Included CSS Files (Uncompressed) -->
  <!--
  <link rel="stylesheet" href="stylesheets/foundation.css">
  -->
  
  <!-- Included CSS Files (Compressed) -->
  <link rel="stylesheet" href="/css/foundation.css">
  <link rel="stylesheet" href="/css/main.css">

  <!-- IE Fix for HTML5 Tags -->
  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <script src="/js/jquery.js"></script>
  <script src="/js/toc.js"></script>
  <script src="/js/main.js"></script>

</head>
<body>

<header class="top-bar" id="header">

<div class="fixed">

<nav class="top-bar">
<ul>
<!-- Title Area -->
	<li class="name has-dropdown">
	<h1><a href="/">JavaScript 标准参考教程（alpha） </a></h1>
		<ul class="dropdown">
			
			<li><a href="/#introduction">导论</a></li>
			
			<li><a href="/#grammar">语法</a></li>
			
			<li><a href="/#stdlib">标准库</a></li>
			
			<li><a href="/#oop">面向对象编程</a></li>
			
			<li><a href="/#advanced">语法专题</a></li>
			
			<li><a href="/#dom">DOM模型</a></li>
			
			<li><a href="/#bom">浏览器环境</a></li>
			
			<li><a href="/#htmlapi">Web API</a></li>
			
		</ul>
	</li>
</ul>

<section>


<ul class="left">
<li class="divider"></li>
<li class="has-dropdown"><a class="active" href="#"> 语法专题 </a><ul class="dropdown">



















<li class="active"><a href="#">MVC框架与Backbone.js</a></li>

















































<li><a href="/advanced/ecmascript6.html">ECMAScript 6 介绍</a></li>





























<li><a href="/advanced/fsm.html">JavaScript与有限状态机</a></li>

























<li><a href="/advanced/interpreter.html">JavaScript解释器</a></li>









































































<li><a href="/advanced/promise.html">Promise 对象</a></li>



















<li><a href="/advanced/single-thread.html">异步操作概述</a></li>











<li><a href="/advanced/strict.html">严格模式</a></li>



















<li><a href="/advanced/timer.html">定时器</a></li>



























</ul></li>
<li class="divider"></li>
<li class="has-dropdown nav-3"><a href="#"> MVC框架与Backbone.js</a><ul class="dropdown">
</ul></li>
</ul>


<ul class="right">
	<li class="divider"></li>
	<li>
		<a href="https://github.com/ruanyf/jstutorial" target="_blank">GitHub <i class="foundicon-edit"></i></a>
	</li>
	<li class="divider"></li>
	<li>
		<a href="#">TOP <i class="foundicon-up-arrow"></i></a>
	</li>
</ul>

</section>

</nav>  
</div>
</header>


<article class="bookPage">

  <div class="row">
    <div class="twelve columns">

<h1> MVC框架与Backbone.js </h1>

<aside class="right"><p>来自<a href="/">《JavaScript 标准参考教程（alpha）》</a>，by 阮一峰</p></aside>

<div id="toc" class="panel callout radius">目录</div>


<h2 id="mvc框架">MVC框架</h2>

<p>随着JavaScript程序变得越来越复杂，往往需要一个团队协作开发，这时代码的模块化和组织规范就变得异常重要了。MVC模式就是代码组织的经典模式。</p>

<p>（……MVC介绍。）</p>

<p><strong>（1）Model</strong></p>

<p>Model表示数据层，也就是程序需要的数据源，通常使用JSON格式表示。</p>

<p><strong>（2）View</strong></p>

<p>View表示表现层，也就是用户界面，对于网页来说，就是用户看到的网页HTML代码。</p>

<p><strong>（3）Controller</strong></p>

<p>Controller表示控制层，用来对原始数据（Model）进行加工，传送到View。</p>

<p>由于网页编程不同于客户端编程，在MVC的基础上，JavaScript社区产生了各种变体框架MVP（Model-View-Presenter）、MVVM（Model-View-ViewModel）等等，有人就把所有这一类框架的各种模式统称为MV*。</p>

<p>框架的优点在于合理组织代码、便于团队合作和未来的维护，缺点在于有一定的学习成本，且限制你只能采取它的写法。</p>

<h2 id="零框架解决方案">零框架解决方案</h2>

<p>MVC框架（尤其是大型框架）有一个严重的缺点，就是会产生用户的重度依赖。一旦框架本身出现问题或者停止更新，用户的处境就会很困难，维护和更新成本极高。</p>

<p>ES6的到来，使得JavaScript语言有了原生的模块解决方案。于是，开发者有了另一种选择，就是不使用MVC框架，只使用各种单一用途的模块库，组合完成一个项目。下面是可供选择的各种用途的模块列表。</p>

<p>辅助功能库（Helper Libraries）</p>

<ul>
  <li><a href="http://momentjs.com/">moment.js</a>：日期和时间的标准化</li>
  <li><a href="http://underscorejs.org/">underscore.js</a> / <a href="https://lodash.com/">Lo-Dash</a>：一系列函数式编程的功能函数</li>
</ul>

<p>路由库（Routing）</p>

<ul>
  <li><a href="https://github.com/tildeio/router.js/">router.js</a>：Ember.js使用的路由库</li>
  <li><a href="https://github.com/tildeio/route-recognizer">route-recognizer</a>：功能全面的路由库</li>
  <li><a href="https://github.com/visionmedia/page.js">page.js</a>：类似Express路由的库</li>
  <li><a href="https://github.com/flatiron/director">director</a>：同时支持服务器和浏览器的路由库</li>
</ul>

<p>Promise库</p>

<ul>
  <li><a href="https://github.com/tildeio/rsvp.js">RSVP.js</a>：ES6兼容的Promise库</li>
  <li><a href="https://github.com/jakearchibald/es6-promise">ES6-Promise</a>：RSVP.js的子集，但是全面兼容ES6</li>
  <li><a href="https://github.com/kriskowal/q">q</a>：最常用的Promise库之一，AngularJS用了它的精简版</li>
  <li><a href="https://github.com/getify/native-promise-only">native-promise-only</a>：严格符合ES6的Promise标准，同时兼容老式浏览器</li>
</ul>

<p>客户端与服务器的通信库</p>

<ul>
  <li><a href="https://github.com/github/fetch">fetch</a>：实现window.fetch功能</li>
  <li><a href="https://github.com/pyrsmk/qwest">qwest</a>：支持XHR2和Promise的Ajax库</li>
  <li><a href="https://github.com/jquery/jquery">jQuery</a>：jQuery 2.0支持按模块打包，因此可以创建一个纯Ajax功能库</li>
</ul>

<p>动画库（Animation）</p>

<ul>
  <li><a href="https://github.com/magnetikonline/cssanimevent">cssanimevent</a>：兼容老式浏览器的CSS3动画库</li>
  <li><a href="http://julian.com/research/velocity/">Velocity.js</a>：性能优秀的动画库</li>
</ul>

<p>辅助开发库（Development Assistance）</p>

<ul>
  <li><a href="https://github.com/bfattori/LogJS">LogJS</a>：轻量级的logging功能库</li>
  <li><a href="https://github.com/nicjansma/usertiming.js">UserTiming.js</a>：支持老式浏览器的高精度时间戳库</li>
</ul>

<p>流程控制和架构（Flow Control/Architecture）</p>

<ul>
  <li><a href="https://github.com/tubalmartin/ondomready">ondomready</a>：类似jQuery的ready()方法，符合AMD规范</li>
  <li><a href="https://github.com/ded/script.js]">script.js</a>：异步的脚本加载和依赖关系管理库</li>
  <li><a href="https://github.com/caolan/async">async</a>：浏览器和node.js的异步管理工具库</li>
  <li><a href="https://github.com/Matt-Esch/virtual-dom">Virtual DOM</a>：react.js的一个替代方案，参见<a href="https://gist.github.com/Raynos/8414846">Virtual DOM and diffing algorithm</a></li>
</ul>

<p>数据绑定（Data-binding）</p>

<ul>
  <li>Object.observe()：Chrome已经支持该方法，可以轻易实现双向数据绑定</li>
</ul>

<p>模板库（Templating）</p>

<ul>
  <li><a href="http://mustache.github.io/">Mustache</a>：大概是目前使用最广的不含逻辑的模板系统</li>
</ul>

<p>微框架（Micro-Framework）</p>

<p>某些情况下，可以使用微型框架，作为项目开发的起点。</p>

<ul>
  <li><a href="https://github.com/young-steveo/bottlejs">bottlejs</a>：提供惰性加载、中间件钩子、装饰器等功能</li>
  <li><a href="http://hay.github.io/stapes/#top">Stapes.js</a>：微型MVC框架</li>
  <li><a href="http://somajs.github.io/somajs/site/">soma.js</a>：提供一个松耦合、易测试的架构</li>
  <li><a href="http://knockoutjs.com/">knockout</a>：最流行的微框架之一，主要关注UI</li>
</ul>

<h2 id="backbone的加载">Backbone的加载</h2>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/javascripts/lib/jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/javascripts/lib/underscore.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/javascripts/lib/backbone.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/javascripts/jst.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/javascripts/router.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/javascripts/init.js"</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></figure>

<h2 id="backbone的用法">Backbone的用法</h2>

<p>Backbone是最早的JavaScript MVC框架，也是最简化的一个框架。它的设计思想是，只提供最基本的功能，给用户提供最大的自由。这意味着，好的一面是它没有一整套规则，强制你接受，坏的一面是很多功能你必须自己实现。Backbone的体积相当小，最小化后只有30多KB。</p>

<p>定义一个对象，表示Web应用。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">AppName</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">Models</span>       <span class="p">:{},</span>
  <span class="na">Views</span>        <span class="p">:{},</span>
  <span class="na">Collections</span>  <span class="p">:{},</span>
  <span class="na">Controllers</span>  <span class="p">:{}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>上面代码表示，应用由四部分组成：Model、Collection、Controller和View。</p>

<p>定义Model，表示数据的一个基本单位。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">AppName</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Person</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">urlRoot</span><span class="p">:</span> <span class="s2">"/persons"</span>
<span class="p">});</span>
</code></pre></div></div>

<p>定义Collection，表示Model的集合。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">AppName</span><span class="p">.</span><span class="nx">Collections</span><span class="p">.</span><span class="nx">Library</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">model</span><span class="p">:</span> <span class="nx">AppName</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Book</span>
<span class="p">});</span>
</code></pre></div></div>

<p>上面代码表示，Collection对象必须有model属性，指明由哪一个model构成。</p>

<p>定义一个View。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">AppName</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Modals</span><span class="p">.</span><span class="nx">AcceptDecline</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">Extend</span><span class="p">({</span>
  <span class="na">el</span><span class="p">:</span> <span class="s2">".modal-accept"</span><span class="p">,</span>

  <span class="na">events</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"ajax:success .link-accept"</span> <span class="p">:</span><span class="s2">"acceptSuccess"</span><span class="p">,</span>
    <span class="s2">"ajax:error   .link-accept"</span> <span class="p">:</span><span class="s2">"acceptError"</span>
  <span class="p">},</span>

  <span class="na">acceptSuccess</span> <span class="p">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">modal</span><span class="p">(</span><span class="s2">"hide"</span><span class="p">);</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">'Cool! Thanks'</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="na">acceptError</span> <span class="p">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$modalContent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">'.panel-modal'</span><span class="p">);</span>

    <span class="nx">$modalContent</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"Something was wrong!"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>View对象必须有el属性，指明当前View绑定的DOM节点，events属性指明事件和对应的方法。</p>

<p>定义一个Controller。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">AppName</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">Person</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">AppName</span><span class="p">.</span><span class="nx">Controllers</span><span class="p">.</span><span class="nx">Person</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">aMa</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppName</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">Person</span><span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="nx">id</span><span class="p">});</span>
  
  <span class="nx">aMa</span><span class="p">.</span><span class="nx">updateAge</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
  
  <span class="nx">aMa</span><span class="p">.</span><span class="nx">fetch</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppName</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Show</span><span class="p">({</span><span class="na">model</span><span class="p">:</span> <span class="nx">aMa</span><span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>
</code></pre></div></div>

<p>最后，定义路由，启动应用程序。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">Workspace</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">routes</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"*"</span>                  <span class="p">:</span><span class="s2">"wholeApp"</span><span class="p">,</span>
    <span class="s2">"users/:id"</span>          <span class="p">:</span><span class="s2">"usersShow"</span><span class="p">,</span>
    <span class="s2">"users/:id/orders/"</span>  <span class="p">:</span><span class="s2">"ordersIndex"</span>
  <span class="p">},</span>
  
  <span class="na">wholeApp</span>    <span class="p">:</span><span class="nx">AppName</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="k">default</span><span class="p">,</span>
  <span class="na">usersShow</span>   <span class="p">:</span><span class="nx">AppName</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">Users</span><span class="p">.</span><span class="nx">show</span><span class="p">,</span>
  <span class="na">ordersIndex</span> <span class="p">:</span><span class="nx">AppName</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">Orders</span><span class="p">.</span><span class="nx">index</span>
<span class="p">});</span>
 
<span class="k">new</span> <span class="nx">Workspace</span><span class="p">();</span>
<span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span><span class="na">pushState</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
</code></pre></div></div>

<h2 id="backboneview">Backbone.View</h2>

<h3 id="基本用法">基本用法</h3>

<p>Backbone.View方法用于定义视图类。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">AppView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'main'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">'&lt;h1&gt;一级标题&lt;/h1&gt;'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>上面代码通过Backbone.View的extend方法，定义了一个视图类AppView。该类内部有一个render方法，用于将视图放置在网页上。</p>

<p>使用的时候，需要先新建视图类的实例，然后通过实例，调用render方法，从而让视图在网页上显示。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">appView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppView</span><span class="p">();</span>
<span class="nx">appView</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span></code></pre></figure>

<p>上面代码新建视图类AppView的实例appView，然后调用appView.render，网页上就会显示指定的内容。</p>

<p>新建视图实例时，通常需要指定Model。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nb">document</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Document</span><span class="p">({</span>
  <span class="na">model</span><span class="p">:</span> <span class="nx">doc</span>
<span class="p">});</span>

</code></pre></div></div>

<h3 id="initialize方法">initialize方法</h3>

<p>视图还可以定义initialize方法，生成实例的时候，会自动调用该方法对实例初始化。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">AppView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">initialize</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'main'</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">'&lt;h1&gt;一级标题&lt;/h1&gt;'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">appView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppView</span><span class="p">();</span>

</code></pre></div></div>

<p>上面代码定义了initialize方法之后，就省去了生成实例后，手动调用appView.render()的步骤。</p>

<h3 id="el属性el属性">el属性，$el属性</h3>

<p>除了直接在render方法中，指定“视图”所绑定的网页元素，还可以用视图的el属性指定网页元素。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">AppView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">el</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'main'</span><span class="p">),</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'&lt;h1&gt;一级标题&lt;/h1&gt;'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>上面的代码与render方法直接绑定网页元素，效果完全一样。上面代码中，除了el属性，还是$el属性，前者代表指定的DOM元素，后者则表示该DOM元素对应的jQuery对象。</p>

<h3 id="tagname属性classname属性">tagName属性，className属性</h3>

<p>如果不指定el属性，也可以通过tagName属性和className属性指定。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">Document</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">tagName</span><span class="p">:</span> <span class="s2">"li"</span><span class="p">,</span>
  <span class="na">className</span><span class="p">:</span> <span class="s2">"document"</span><span class="p">,</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">});</span>

</code></pre></div></div>

<h3 id="template方法">template方法</h3>

<p>视图的template属性用来指定网页模板。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">AppView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
      <span class="na">template</span><span class="p">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">"&lt;h3&gt;Hello &lt;%= who %&gt;&lt;h3&gt;"</span><span class="p">),</span>
<span class="p">});</span>

</code></pre></div></div>

<p>上面代码中，underscore函数库的template函数，接受一个模板字符串作为参数，返回对应的模板函数。有了这个模板函数，只要提供具体的值，就能生成网页代码。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">AppView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
      <span class="na">el</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#container'</span><span class="p">),</span>
      <span class="na">template</span><span class="p">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="s2">"&lt;h3&gt;Hello &lt;%= who %&gt;&lt;h3&gt;"</span><span class="p">),</span>
      <span class="na">initialize</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
      <span class="p">},</span>
      <span class="na">render</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">({</span><span class="na">who</span><span class="p">:</span> <span class="s1">'world!'</span><span class="p">}));</span>
      <span class="p">}</span>
<span class="p">});</span>

</code></pre></div></div>

<p>上面代码的render就调用了template方法，从而生成具体的网页代码。</p>

<p>实际应用中，一般将模板放在script标签中，为了防止浏览器按照JavaScript代码解析，type属性设为text/template。</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/template"</span> <span class="na">data-name=</span><span class="s">"templateName"</span><span class="nt">&gt;</span>
    <span class="o">&lt;!--</span> <span class="nx">template</span> <span class="nx">contents</span> <span class="nx">goes</span> <span class="nx">here</span> <span class="o">--&gt;</span>
<span class="nt">&lt;/script&gt;</span></code></pre></figure>

<p>可以使用下面的代码编译模板。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">templates</span> <span class="o">=</span> <span class="p">{};</span>

<span class="kd">var</span> <span class="nx">$sources</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'script[type="text/template"]'</span><span class="p">);</span>

<span class="nx">$sources</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
    <span class="nx">templates</span><span class="p">[</span><span class="nx">$el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">());</span>
<span class="p">});</span></code></pre></figure>

<h3 id="events属性">events属性</h3>

<p>events属性用于指定视图的事件及其对应的处理函数。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">Document</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">events</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"click .icon"</span><span class="p">:</span>          <span class="s2">"open"</span><span class="p">,</span>
    <span class="s2">"click .button.edit"</span><span class="p">:</span>   <span class="s2">"openEditDialog"</span><span class="p">,</span>
    <span class="s2">"click .button.delete"</span><span class="p">:</span> <span class="s2">"destroy"</span>
  <span class="p">}</span>
<span class="p">});</span>

</code></pre></div></div>

<p>上面代码中一个指定了三个CSS选择器的单击事件，及其对应的三个处理函数。</p>

<h3 id="listento方法">listento方法</h3>

<p>listento方法用于为特定事件指定回调函数。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">Document</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">initialize</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span> <span class="s2">"change"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

</code></pre></div></div>

<p>上面代码为model的change事件，指定了回调函数为render。</p>

<h3 id="remove方法">remove方法</h3>

<p>remove方法用于移除一个视图。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">updateView</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">view</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
  <span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
<span class="p">};</span>

</code></pre></div></div>

<h3 id="子视图subview">子视图（subview）</h3>

<p>在父视图中可以调用子视图。下面就是一种写法。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">render</span> <span class="p">:</span> <span class="kd">function</span> <span class="p">(){</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">());</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">child</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Child</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">child</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$</span><span class="p">.(</span><span class="s1">'.container-placeholder'</span><span class="p">).</span><span class="nx">render</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

<h2 id="backboneevents">Backbone.Events</h2>

<p><code class="highlighter-rouge">Backbone.Events</code>是一个事件对象。任何继承了这个对象的对象，都具备了<code class="highlighter-rouge">Backbone.Events</code>的事件接口，可以调用on和trigger方法，发布和订阅消息。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">EventChannel</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">);</span>
</code></pre></div></div>

<p>下面是一些例子。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">channel</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="p">{},</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span> <span class="p">);</span>
<span class="nx">channel</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'remove-node'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// code to remove the node</span>
<span class="p">});</span>
<span class="nx">channel</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span> <span class="s1">'remove-node'</span><span class="p">,</span> <span class="nx">msg</span> <span class="p">);</span>
<span class="c1">// 'msg' can be everything: String, number, object and so forth</span>
<span class="c1">// also we can pass more than one message like the example below</span>
<span class="nx">channel</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'add-node'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// code to add a new node</span>
  <span class="nx">callback</span><span class="p">();</span>
<span class="p">}</span> <span class="p">);</span>
<span class="nx">channel</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">'add-node'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">label</span><span class="p">:</span> <span class="s1">'I am a new node'</span><span class="p">,</span>
  <span class="na">color</span><span class="p">:</span> <span class="s1">'black'</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s1">'I am a callback'</span> <span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="backbonerouter">Backbone.Router</h2>

<p>Router是Backbone提供的路由对象，用来将用户请求的网址与后端的处理函数一一对应。</p>

<p>首先，新定义一个Router类。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Router</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">routes</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h2 id="routes属性">routes属性</h2>

<p>Backbone.Router对象中，最重要的就是routes属性。它用来设置路径的处理方法。</p>

<p>routes属性是一个对象，它的每个成员就代表一个路径处理规则，键名为路径规则，键值为处理方法。</p>

<p>如果键名为空字符串，就代表根路径。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">routes</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">''</span><span class="p">:</span> <span class="s1">'phonesIndex'</span><span class="p">,</span>
<span class="p">},</span>

<span class="nx">phonesIndex</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">new</span> <span class="nx">PhonesIndexView</span><span class="p">({</span> <span class="na">el</span><span class="p">:</span> <span class="s1">'section#main'</span> <span class="p">});</span>
<span class="p">}</span></code></pre></figure>

<p>星号代表任意路径，可以设置路径参数，捕获具体的路径值。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">AppRouter</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">routes</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"*actions"</span><span class="p">:</span> <span class="s2">"defaultRoute"</span> 
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">app_router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppRouter</span><span class="p">;</span>

<span class="nx">app_router</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'route:defaultRoute'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">actions</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">actions</span><span class="p">);</span>
<span class="p">})</span>

</code></pre></div></div>

<p>上面代码中，根路径后面的参数，都会被捕获，传入回调函数。</p>

<p>路径规则的写法。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">myrouter</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">routes</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"help"</span><span class="p">:</span>                 <span class="s2">"help"</span><span class="p">,</span>    
    <span class="s2">"search/:query"</span><span class="p">:</span>        <span class="s2">"search"</span> 
  <span class="p">},</span>

  <span class="na">help</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">},</span>

  <span class="na">search</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nl">routes</span><span class="p">:</span> <span class="p">{</span>
  <span class="s2">"help/:page"</span><span class="p">:</span>         <span class="s2">"help"</span><span class="p">,</span>
  <span class="s2">"download/*path"</span><span class="p">:</span>     <span class="s2">"download"</span><span class="p">,</span>
  <span class="s2">"folder/:name"</span><span class="p">:</span>       <span class="s2">"openFolder"</span><span class="p">,</span>
  <span class="s2">"folder/:name-:mode"</span><span class="p">:</span> <span class="s2">"openFolder"</span>
<span class="p">}</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"route:help"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">});</span>

</code></pre></div></div>

<h2 id="backbonehistory">Backbone.history</h2>

<p>设置了router以后，就可以启动应用程序。Backbone.history对象用来监控url的变化。</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">App</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">();</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span> <span class="na">pushState</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>打开pushState方法。如果应用程序不在根目录，就需要指定根目录。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span><span class="na">pushState</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">root</span><span class="p">:</span> <span class="s2">"/public/search/"</span><span class="p">})</span>

</code></pre></div></div>

<h2 id="backbonemodel">Backbone.Model</h2>

<p>Model代表单个的对象实体。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="na">defaults</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
            <span class="na">email</span><span class="p">:</span> <span class="s1">''</span>
        <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>

</code></pre></div></div>

<p>上面代码使用extend方法，生成了一个User类，它代表model的模板。然后，使用new命令，生成一个Model的实例。defaults属性用来设置默认属性，上面代码表示user对象默认有name和email两个属性，它们的值都等于空字符串。</p>

<p>生成实例时，可以提供各个属性的具体值。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span> <span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'name'</span><span class="p">,</span>
    <span class="na">email</span><span class="p">:</span> <span class="s1">'name@email.com'</span>
<span class="p">});</span>

</code></pre></div></div>

<p>上面代码在生成实例时，提供了各个属性的具体值。</p>

<h3 id="idattribute属性">idAttribute属性</h3>

<p>Model实例必须有一个属性，作为区分其他实例的主键。这个属性的名称，由idAttribute属性设定，一般是设为id。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">Music</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span> 
    <span class="na">idAttribute</span><span class="p">:</span> <span class="s1">'id'</span>
<span class="p">});</span>

</code></pre></div></div>

<h3 id="get方法">get方法</h3>

<p>get方法用于返回Model实例的某个属性的值。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"name"</span><span class="p">,</span> <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">});</span>
<span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s2">"age"</span><span class="p">);</span> <span class="c1">// 24</span>
<span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s2">"name"</span><span class="p">);</span> <span class="c1">// "name"</span>

</code></pre></div></div>

<h3 id="set方法">set方法</h3>

<p>set方法用于设置Model实例的某个属性的值。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">buy</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newCarsName</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="kd">set</span><span class="p">({</span><span class="na">car</span><span class="p">:</span> <span class="nx">newCarsName</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">({</span><span class="na">name</span><span class="p">:</span> <span class="s1">'BMW'</span><span class="p">,</span><span class="na">model</span><span class="p">:</span><span class="s1">'i8'</span><span class="p">,</span><span class="na">type</span><span class="p">:</span><span class="s1">'car'</span><span class="p">});</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">buy</span><span class="p">(</span><span class="s1">'Porsche'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">car</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s2">"car"</span><span class="p">);</span> <span class="c1">// ‘Porsche’</span>

</code></pre></div></div>

<h3 id="on方法">on方法</h3>

<p>on方法用于监听对象的变化。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">({</span><span class="na">name</span><span class="p">:</span> <span class="s1">'BMW'</span><span class="p">,</span><span class="na">model</span><span class="p">:</span><span class="s1">'i8'</span><span class="p">});</span>

<span class="nx">user</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"change:name"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s2">"name"</span><span class="p">);</span> <span class="c1">// "Porsche"</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Changed my car’s name to "</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">user</span><span class="p">.</span><span class="kd">set</span><span class="p">({</span><span class="na">name</span><span class="p">:</span> <span class="s1">'Porsche'</span><span class="p">});</span> 
<span class="c1">// Changed my car’s name to Porsche</span>

</code></pre></div></div>

<p>上面代码中的on方法用于监听事件，“change:name”表示name属性发生变化。</p>

<h3 id="urlroot属性">urlroot属性</h3>

<p>该属性用于指定服务器端对model进行操作的路径。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">urlRoot</span><span class="p">:</span> <span class="s1">'/user'</span>
<span class="p">});</span>

</code></pre></div></div>

<p>上面代码指定，服务器对应该Model的路径为/user。</p>

<h3 id="fetch事件">fetch事件</h3>

<p>fetch事件用于从服务器取出Model。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span> <span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">});</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">})</span>

</code></pre></div></div>

<p>上面代码中，user实例含有id属性（值为1），fetch方法使用HTTP动词GET，向网址“/user/1”发出请求，从服务器取出该实例。</p>

<h3 id="save方法">save方法</h3>

<p>save方法用于通知服务器新建或更新Model。</p>

<p>如果一个Model实例不含有id属性，则save方法将使用POST方法新建该实例。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">urlRoot</span><span class="p">:</span> <span class="s1">'/user'</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span> <span class="p">();</span>
<span class="kd">var</span> <span class="nx">userDetails</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'name'</span><span class="p">,</span>
    <span class="na">email</span><span class="p">:</span> <span class="s1">'name@email.com'</span>
<span class="p">};</span>

<span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">userDetails</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">})</span>

</code></pre></div></div>

<p>上面代码先在类中指定Model对应的网址是/user，然后新建一个实例，最后调用save方法。它有两个参数，第一个是实例对象的具体属性，第二个参数是一个回调函数对象，设定success事件（保存成功）的回调函数。具体来说，save方法会向/user发出一个POST请求，并将{name: ‘name’, email: ‘name@email.com’}作为数据提供。</p>

<p>如果一个Model实例含有id属性，则save方法将使用PUT方法更新该实例。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span> <span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'张三'</span><span class="p">,</span>
    <span class="na">email</span><span class="p">:</span> <span class="s1">'name@email.com'</span>
<span class="p">});</span>

<span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span><span class="na">name</span><span class="p">:</span> <span class="s1">'李四'</span><span class="p">},</span> <span class="p">{</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">});</span> 

</code></pre></div></div>

<p>上面代码中，对象实例含有id属性（值为1），save将使用PUT方法向网址“/user/1”发出请求，从而更新该实例。</p>

<h3 id="destroy方法">destroy方法</h3>

<p>destroy方法用于在服务器上删除该实例。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span> <span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'name'</span><span class="p">,</span>
    <span class="na">email</span><span class="p">:</span> <span class="s1">'name@email.com'</span>
<span class="p">});</span>

<span class="nx">user</span><span class="p">.</span><span class="nx">destroy</span><span class="p">({</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Destroyed'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

</code></pre></div></div>

<p>上面代码的destroy方法，将使用HTTP动词DELETE，向网址“/user/1”发出请求，删除对应的Model实例。</p>

<h2 id="backbonecollection">Backbone.Collection</h2>

<p>Collection是同一类Model的集合，比如Model是动物，Collection就是动物园；Model是单个的人，Collection就是一家公司。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">Song</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({});</span>

<span class="kd">var</span> <span class="nx">Album</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">model</span><span class="p">:</span> <span class="nx">Song</span>
<span class="p">});</span>

</code></pre></div></div>

<p>上面代码中，Song是Model，Album是Collection，而且Album有一个model属性等于Song，因此表明Album是Song的集合。</p>

<h3 id="add方法remove方法">add方法，remove方法</h3>

<p>Model的实例可以直接放入Collection的实例，也可以用add方法添加。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">song1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Song</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="mi">1</span> <span class="p">,</span><span class="na">name</span><span class="p">:</span> <span class="s2">"歌名1"</span><span class="p">,</span> <span class="na">artist</span><span class="p">:</span> <span class="s2">"张三"</span> <span class="p">});</span>
<span class="kd">var</span> <span class="nx">song2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Music</span> <span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span><span class="na">name</span><span class="p">:</span> <span class="s2">"歌名2"</span><span class="p">,</span> <span class="na">artist</span><span class="p">:</span> <span class="s2">"李四"</span> <span class="p">});</span>
<span class="kd">var</span> <span class="nx">myAlbum</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Album</span><span class="p">([</span><span class="nx">song1</span><span class="p">,</span> <span class="nx">song2</span><span class="p">]);</span>

<span class="kd">var</span> <span class="nx">song3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Music</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s2">"歌名3"</span><span class="p">,</span><span class="na">artist</span><span class="p">:</span><span class="s2">"赵五"</span> <span class="p">});</span>
<span class="nx">myAlbum</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">song3</span><span class="p">);</span>

</code></pre></div></div>

<p>remove方法用于从Collection实例中移除一个Model实例。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nx">myAlbum</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

</code></pre></div></div>

<p>上面代码表明，remove方法的参数是model实例的id属性。</p>

<h3 id="get方法set方法">get方法，set方法</h3>

<p>get方法用于从Collection中获取指定id的Model实例。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">myAlbum</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="fetch方法">fetch方法</h3>

<p>fetch方法用于从服务器取出Collection数据。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">songs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">;</span>
<span class="nx">songs</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="s1">'/songs'</span><span class="p">;</span>
<span class="nx">songs</span><span class="p">.</span><span class="nx">fetch</span><span class="p">();</span>

</code></pre></div></div>

<h2 id="backboneevents-1">Backbone.events</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Events</span><span class="p">);</span>

<span class="nx">obj</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"show-message"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">'#display'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">obj</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">"show-message"</span><span class="p">,</span> <span class="s2">"Hello World"</span><span class="p">);</span>

</code></pre></div></div>

<h2 id="参考链接">参考链接</h2>

<ul>
  <li>Andy Walpole, <a href="https://andywalpole.me/#!/blog/142134/2015-the-end-the-monolithic-javascript-framework">2015: The End of the Monolithic JavaScript Framework</a></li>
  <li>Biswadeep Ghosh, <a href="http://www.phloxblog.in/introduction-backbone-js/">Introduction to Backbone.js</a></li>
</ul>


</article>

<div class="row">
<div class="twelve columns">

<h2>留言</h2>

<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jstutorial'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</section>

</div>
</div>

<footer>
<div class="row">
<div class="twelve columns">
	<p><a href="/introduction/license.html">版权声明</a> | last modified on 2014-02-09 </p>
</div>
</div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43771063-1', 'ruanyifeng.com');
  ga('send', 'pageview');
</script>
</body>
</html>


