<!DOCTYPE html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />

  <title>window对象 -- JavaScript 标准参考教程（alpha）</title>
  
  <!-- Included CSS Files (Uncompressed) -->
  <!--
  <link rel="stylesheet" href="stylesheets/foundation.css">
  -->
  
  <!-- Included CSS Files (Compressed) -->
  <link rel="stylesheet" href="/css/foundation.css">
  <link rel="stylesheet" href="/css/main.css">

  <!-- IE Fix for HTML5 Tags -->
  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <script src="/js/jquery.js"></script>
  <script src="/js/toc.js"></script>
  <script src="/js/main.js"></script>

</head>
<body>

<header class="top-bar" id="header">

<div class="fixed">

<nav class="top-bar">
<ul>
<!-- Title Area -->
	<li class="name has-dropdown">
	<h1><a href="/">JavaScript 标准参考教程（alpha） </a></h1>
		<ul class="dropdown">
			
			<li><a href="/#introduction">导论</a></li>
			
			<li><a href="/#grammar">语法</a></li>
			
			<li><a href="/#stdlib">标准库</a></li>
			
			<li><a href="/#oop">面向对象编程</a></li>
			
			<li><a href="/#advanced">语法专题</a></li>
			
			<li><a href="/#dom">DOM模型</a></li>
			
			<li><a href="/#bom">浏览器环境</a></li>
			
			<li><a href="/#htmlapi">Web API</a></li>
			
		</ul>
	</li>
</ul>

<section>


<ul class="left">
<li class="divider"></li>
<li class="has-dropdown"><a class="active" href="#"> 浏览器环境 </a><ul class="dropdown">



<li><a href="/bom/ajax.html">AJAX</a></li>











































<li><a href="/bom/cookie.html">Cookie</a></li>





<li><a href="/bom/cors.html">CORS通信</a></li>





























<li><a href="/bom/engine.html">浏览器环境概述</a></li>

































<li><a href="/bom/history.html">history对象</a></li>













<li><a href="/bom/indexeddb.html">IndexedDB：浏览器端数据库</a></li>























<li><a href="/bom/mobile.html">移动设备API</a></li>

















<li><a href="/bom/notification.html">Web Notifications API</a></li>





























<li><a href="/bom/performance.html">Performance API</a></li>



























<li><a href="/bom/same-origin.html">同源政策</a></li>











































<li><a href="/htmlapi/webrtc.html">WebRTC</a></li>





<li><a href="/htmlapi/websocket.html">WebSocket</a></li>







<li><a href="/bom/webstorage.html">Web Storage：浏览器端数据储存机制</a></li>







<li class="active"><a href="#">window对象</a></li>





</ul></li>
<li class="divider"></li>
<li class="has-dropdown nav-3"><a href="#"> window对象</a><ul class="dropdown">
</ul></li>
</ul>


<ul class="right">
	<li class="divider"></li>
	<li>
		<a href="https://github.com/ruanyf/jstutorial" target="_blank">GitHub <i class="foundicon-edit"></i></a>
	</li>
	<li class="divider"></li>
	<li>
		<a href="#">TOP <i class="foundicon-up-arrow"></i></a>
	</li>
</ul>

</section>

</nav>  
</div>
</header>


<article class="bookPage">

  <div class="row">
    <div class="twelve columns">

<h1> window对象 </h1>

<aside class="right"><p>来自<a href="/">《JavaScript 标准参考教程（alpha）》</a>，by 阮一峰</p></aside>

<div id="toc" class="panel callout radius">目录</div>


<h2 id="概述">概述</h2>

<p>在浏览器中，<code class="highlighter-rouge">window</code>对象（注意，<code class="highlighter-rouge">w</code>为小写）指当前的浏览器窗口。它也是所有对象的顶层对象。</p>

<p>“顶层对象”指的是最高一层的对象，所有其他对象都是它的下属。JavaScript规定，浏览器环境的所有全局变量，都是<code class="highlighter-rouge">window</code>对象的属性。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">a</span> <span class="c1">// 1</span>
</code></pre></div></div>

<p>上面代码中，变量<code class="highlighter-rouge">a</code>是一个全局变量，但是实质上它是<code class="highlighter-rouge">window</code>对象的属性。声明一个全局变量，就是为<code class="highlighter-rouge">window</code>对象的同名属性赋值。</p>

<p>从语言设计的角度看，所有变量都是<code class="highlighter-rouge">window</code>对象的属性，其实不是很合理。因为<code class="highlighter-rouge">window</code>对象有自己的实体含义，不适合当作最高一层的顶层对象。这个设计失误与JavaScript语言匆忙的设计过程有关，最早的设想是语言内置的对象越少越好，这样可以提高浏览器的性能。因此，语言设计者Brendan Eich就把<code class="highlighter-rouge">window</code>对象当作顶层对象，所有未声明就赋值的变量都自动变成<code class="highlighter-rouge">window</code>对象的属性。这种设计使得编译阶段无法检测出未声明变量，但到了今天已经没有办法纠正了。</p>

<h2 id="window对象的属性">window对象的属性</h2>

<h3 id="windowwindowwindowname">window.window，window.name</h3>

<p><code class="highlighter-rouge">window</code>对象的<code class="highlighter-rouge">window</code>属性指向自身。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nb">window</span> <span class="o">===</span> <span class="k">this</span> <span class="c1">// true</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">window.name</code>属性用于设置当前浏览器窗口的名字。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">'Hello World!'</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
<span class="c1">// "Hello World!"</span>
</code></pre></div></div>

<p>各个浏览器对这个值的储存容量有所不同，但是一般来说，可以高达几MB。</p>

<p>该属性只能保存字符串，且当浏览器窗口关闭后，所保存的值就会消失。因此局限性比较大，但是与<code class="highlighter-rouge">&lt;iframe&gt;</code>窗口通信时，非常有用。</p>

<h3 id="windowlocation">window.location</h3>

<p><code class="highlighter-rouge">window.location</code>返回一个<code class="highlighter-rouge">location</code>对象，用于获取窗口当前的URL信息。它等同于<code class="highlighter-rouge">document.location</code>对象，详细介绍见《document对象》一节。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span> <span class="c1">// true</span>
</code></pre></div></div>

<h3 id="windowclosedwindowopener">window.closed，window.opener</h3>

<p><code class="highlighter-rouge">window.closed</code>属性返回一个布尔值，表示窗口是否关闭。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">closed</span> <span class="c1">// false</span>
</code></pre></div></div>

<p>上面代码检查当前窗口是否关闭。这种检查意义不大，因为只要能运行代码，当前窗口肯定没有关闭。这个属性一般用来检查，使用脚本打开的新窗口是否关闭。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">popup</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>

<span class="k">if</span> <span class="p">((</span><span class="nx">popup</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">popup</span><span class="p">.</span><span class="nx">closed</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 窗口仍然打开着</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">window.opener</code>属性返回打开当前窗口的父窗口。如果当前窗口没有父窗口，则返回<code class="highlighter-rouge">null</code>。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">opener</span> <span class="o">===</span> <span class="nb">window</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>上面表达式会打开一个新窗口，然后返回<code class="highlighter-rouge">true</code>。</p>

<p>通过<code class="highlighter-rouge">opener</code>属性，可以获得父窗口的的全局变量和方法，比如<code class="highlighter-rouge">window.opener.propertyName</code>和<code class="highlighter-rouge">window.opener.functionName()</code>。但这只限于两个窗口属于同源的情况（参见《<a href="/bom/same-origin.html">同源政策</a>》一节），且其中一个窗口由另一个打开。</p>

<h3 id="windowframeswindowlength">window.frames，window.length</h3>

<p><code class="highlighter-rouge">window.frames</code>属性返回一个类似数组的对象，成员为页面内所有框架窗口，包括<code class="highlighter-rouge">frame</code>元素和<code class="highlighter-rouge">iframe</code>元素。<code class="highlighter-rouge">window.frames[0]</code>表示页面中第一个框架窗口。</p>

<p>如果<code class="highlighter-rouge">iframe</code>元素设置了<code class="highlighter-rouge">id</code>或<code class="highlighter-rouge">name</code>属性，那么就可以用属性值，引用这个<code class="highlighter-rouge">iframe</code>窗口。比如<code class="highlighter-rouge">&lt;iframe name="myIFrame"&gt;</code>就可以用<code class="highlighter-rouge">frames['myIFrame']</code>或者<code class="highlighter-rouge">frames.myIFrame</code>来引用。</p>

<p><code class="highlighter-rouge">frames</code>属性实际上是<code class="highlighter-rouge">window</code>对象的别名。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">frames</span> <span class="o">===</span> <span class="nb">window</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>因此，<code class="highlighter-rouge">frames[0]</code>也可以用<code class="highlighter-rouge">window[0]</code>表示。但是，从语义上看，<code class="highlighter-rouge">frames</code>更清晰，而且考虑到<code class="highlighter-rouge">window</code>还是全局对象，因此推荐表示多窗口时，总是使用<code class="highlighter-rouge">frames[0]</code>的写法。更多介绍请看下文的《多窗口操作》部分。</p>

<p><code class="highlighter-rouge">window.length</code>属性返回当前网页包含的框架总数。如果当前网页不包含<code class="highlighter-rouge">frame</code>和<code class="highlighter-rouge">iframe</code>元素，那么<code class="highlighter-rouge">window.length</code>就返回<code class="highlighter-rouge">0</code>。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nb">window</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// true</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">window.frames.length</code>与<code class="highlighter-rouge">window.length</code>应该是相等的。</p>

<h3 id="windowscreenxwindowscreeny">window.screenX，window.screenY</h3>

<p><code class="highlighter-rouge">window.screenX</code>和<code class="highlighter-rouge">window.screenY</code>属性，返回浏览器窗口左上角相对于当前屏幕左上角（<code class="highlighter-rouge">(0, 0)</code>）的水平距离和垂直距离，单位为像素。</p>

<h3 id="windowinnerheightwindowinnerwidth">window.innerHeight，window.innerWidth</h3>

<p><code class="highlighter-rouge">window.innerHeight</code>和<code class="highlighter-rouge">window.innerWidth</code>属性，返回网页在当前窗口中可见部分的高度和宽度，即“视口”（viewport），单位为像素。</p>

<p>当用户放大网页的时候（比如将网页从100%的大小放大为200%），这两个属性会变小。因为这时网页的像素大小不变（比如宽度还是960像素），只是每个像素占据的屏幕空间变大了，因为可见部分（视口）就变小了。</p>

<p>注意，这两个属性值包括滚动条的高度和宽度。</p>

<h3 id="windowouterheightwindowouterwidth">window.outerHeight，window.outerWidth</h3>

<p><code class="highlighter-rouge">window.outerHeight</code>和<code class="highlighter-rouge">window.outerWidth</code>属性返回浏览器窗口的高度和宽度，包括浏览器菜单和边框，单位为像素。</p>

<h3 id="windowpagexoffsetwindowpageyoffset">window.pageXOffset，window.pageYOffset</h3>

<p><code class="highlighter-rouge">window.pageXOffset</code>属性返回页面的水平滚动距离，<code class="highlighter-rouge">window.pageYOffset</code>属性返回页面的垂直滚动距离，单位都为像素。</p>

<p>举例来说，如果用户向下拉动了垂直滚动条75像素，那么<code class="highlighter-rouge">window.pageYOffset</code>就是75。用户水平向右拉动水平滚动条200像素，<code class="highlighter-rouge">window.pageXOffset</code>就是200。</p>

<h2 id="navigator对象">navigator对象</h2>

<p><code class="highlighter-rouge">window</code>对象的<code class="highlighter-rouge">navigator</code>属性，指向一个包含浏览器信息的对象。</p>

<h3 id="navigatoruseragent">navigator.userAgent</h3>

<p><code class="highlighter-rouge">navigator.userAgent</code>属性返回浏览器的User-Agent字符串，标示浏览器的厂商和版本信息。</p>

<p>下面是Chrome浏览器的<code class="highlighter-rouge">userAgent</code>。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">navigator</span><span class="p">.</span><span class="nx">userAgent</span>
<span class="c1">// "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.57 Safari/537.36"</span>
</code></pre></div></div>

<p>通过<code class="highlighter-rouge">userAgent</code>属性识别浏览器，不是一个好办法。因为必须考虑所有的情况（不同的浏览器，不同的版本），非常麻烦，而且无法保证未来的适用性，更何况各种上网设备层出不穷，难以穷尽。所以，现在一般不再识别浏览器了，而是使用“功能识别”方法，即逐一测试当前浏览器是否支持要用到的JavaScript功能。</p>

<p>不过，通过<code class="highlighter-rouge">userAgent</code>可以大致准确地识别手机浏览器，方法就是测试是否包含<code class="highlighter-rouge">mobi</code>字符串。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">ua</span> <span class="o">=</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="sr">/mobi/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ua</span><span class="p">))</span> <span class="p">{</span>
  <span class="c1">// 手机浏览器</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// 非手机浏览器</span>
<span class="p">}</span>
</code></pre></div></div>

<p>如果想要识别所有移动设备的浏览器，可以测试更多的特征字符串。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="nx">mobi</span><span class="o">|</span><span class="nx">android</span><span class="o">|</span><span class="nx">touch</span><span class="o">|</span><span class="nx">mini</span><span class="o">/</span><span class="nx">i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="navigatorplugins">navigator.plugins</h3>

<p><code class="highlighter-rouge">navigator.plugins</code>属性返回一个类似数组的对象，成员是浏览器安装的插件，比如Flash、ActiveX等。</p>

<h3 id="navigatorplatform">navigator.platform</h3>

<p><code class="highlighter-rouge">navigator.platform</code>属性返回用户的操作系统信息。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">navigator</span><span class="p">.</span><span class="nx">platform</span>
<span class="c1">// "Linux x86_64"</span>
</code></pre></div></div>

<h3 id="navigatoronline">navigator.onLine</h3>

<p><code class="highlighter-rouge">navigator.onLine</code>属性返回一个布尔值，表示用户当前在线还是离线。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">navigator</span><span class="p">.</span><span class="nx">onLine</span> <span class="c1">// true</span>
</code></pre></div></div>

<h3 id="navigatorgeolocation">navigator.geolocation</h3>

<p><code class="highlighter-rouge">navigator.geolocation</code>返回一个Geolocation对象，包含用户地理位置的信息。</p>

<h3 id="navigatorjavaenablednavigatorcookieenabled">navigator.javaEnabled()，navigator.cookieEnabled</h3>

<p><code class="highlighter-rouge">javaEnabled</code>方法返回一个布尔值，表示浏览器是否能运行Java Applet小程序。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">navigator</span><span class="p">.</span><span class="nx">javaEnabled</span><span class="p">()</span> <span class="c1">// false</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">cookieEnabled</code>属性返回一个布尔值，表示浏览器是否能储存Cookie。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">navigator</span><span class="p">.</span><span class="nx">cookieEnabled</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>注意，这个返回值与是否储存某个网站的Cookie无关。用户可以设置某个网站不得储存Cookie，这时<code class="highlighter-rouge">cookieEnabled</code>返回的还是<code class="highlighter-rouge">true</code>。</p>

<h2 id="windowscreen对象">window.screen对象</h2>

<p><code class="highlighter-rouge">window.screen</code>对象包含了显示设备的信息。</p>

<p><code class="highlighter-rouge">screen.height</code>和<code class="highlighter-rouge">screen.width</code>两个属性，一般用来了解设备的分辨率。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 显示设备的高度，单位为像素</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">height</span> <span class="c1">// 1920</span>

<span class="c1">// 显示设备的宽度，单位为像素</span>
<span class="nx">screen</span><span class="p">.</span><span class="nx">width</span> <span class="c1">// 1080</span>
</code></pre></div></div>

<p>上面代码显示，某设备的分辨率是1920x1080。</p>

<p>除非调整显示器的分辨率，否则这两个值可以看作常量，不会发生变化。显示器的分辨率与浏览器设置无关，缩放网页并不会改变分辨率。</p>

<p>下面是根据屏幕分辨率，将用户导向不同网页的代码。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">((</span><span class="nx">screen</span><span class="p">.</span><span class="nx">width</span> <span class="o">&lt;=</span> <span class="mi">800</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">screen</span><span class="p">.</span><span class="nx">height</span> <span class="o">&lt;=</span> <span class="mi">600</span><span class="p">))</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'small.html'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">'wide.html'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">screen.availHeight</code>和<code class="highlighter-rouge">screen.availWidth</code>属性返回屏幕可用的高度和宽度，单位为像素。它们的值为屏幕的实际大小减去操作系统某些功能占据的空间，比如系统的任务栏。</p>

<p><code class="highlighter-rouge">screen.colorDepth</code>属性返回屏幕的颜色深度，一般为16（表示16-bit）或24（表示24-bit）。</p>

<h2 id="window对象的方法">window对象的方法</h2>

<h3 id="windowmovetowindowmoveby">window.moveTo()，window.moveBy()</h3>

<p><code class="highlighter-rouge">window.moveTo</code>方法用于移动浏览器窗口到指定位置。它接受两个参数，分别是窗口左上角距离屏幕左上角的水平距离和垂直距离，单位为像素。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码将窗口移动到屏幕<code class="highlighter-rouge">(100, 200)</code>的位置。</p>

<p><code class="highlighter-rouge">window.moveBy</code>方法将窗口移动到一个相对位置。它接受两个参数，分布是窗口左上角向右移动的水平距离和向下移动的垂直距离，单位为像素。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">moveBy</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码将窗口向右移动25像素、向下移动50像素。</p>

<h3 id="windowscrolltowindowscrollby">window.scrollTo()，window.scrollBy()</h3>

<p><code class="highlighter-rouge">window.scrollTo</code>方法用于将网页的指定位置，滚动到浏览器左上角。它的参数是相对于整张网页的横坐标和纵坐标。它有一个别名<code class="highlighter-rouge">window.scroll</code>。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">window.scrollBy</code>方法用于将网页移动指定距离，单位为像素。它接受两个参数：向右滚动的像素，向下滚动的像素。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">scrollBy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码用于将网页向下滚动一屏。</p>

<h3 id="windowopen-windowclose">window.open(), window.close()</h3>

<p><code class="highlighter-rouge">window.open</code>方法用于新建另一个浏览器窗口，并且返回该窗口对象。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">popup</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'somefile.html'</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码会让浏览器弹出一个新建窗口，网址是当前域名下的<code class="highlighter-rouge">somefile.html</code>。</p>

<p><code class="highlighter-rouge">open</code>方法一共可以接受四个参数。</p>

<ul>
  <li>第一个参数：字符串，表示新窗口的网址。如果省略，默认网址就是<code class="highlighter-rouge">about:blank</code>。</li>
  <li>第二个参数：字符串，表示新窗口的名字。如果该名字的窗口已经存在，则跳到该窗口，不再新建窗口。如果省略，就默认使用<code class="highlighter-rouge">_blank</code>，表示新建一个没有名字的窗口。</li>
  <li>第三个参数：字符串，内容为逗号分隔的键值对，表示新窗口的参数，比如有没有提示栏、工具条等等。如果省略，则默认打开一个完整UI的新窗口。</li>
  <li>第四个参数：布尔值，表示第一个参数指定的网址，是否应该替换<code class="highlighter-rouge">history</code>对象之中的当前网址记录，默认值为<code class="highlighter-rouge">false</code>。显然，这个参数只有在第二个参数指向已经存在的窗口时，才有意义。</li>
</ul>

<p>下面是一个例子。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">popup</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span>
  <span class="s1">'somepage.html'</span><span class="p">,</span>
  <span class="s1">'DefinitionsWindows'</span><span class="p">,</span>
  <span class="s1">'height=200,width=200,location=no,status=yes,resizable=yes,scrollbars=yes'</span>
<span class="p">);</span>
</code></pre></div></div>

<p>上面代码表示，打开的新窗口高度和宽度都为200像素，没有地址栏和滚动条，但有状态栏，允许用户调整大小。</p>

<p>注意，如果在第三个参数中设置了一部分参数，其他没有被设置的<code class="highlighter-rouge">yes/no</code>参数都会被设成<code class="highlighter-rouge">no</code>，只有<code class="highlighter-rouge">titlebar</code>和关闭按钮除外（它们的值默认为<code class="highlighter-rouge">yes</code>）。</p>

<p>另外，<code class="highlighter-rouge">open</code>方法的第二个参数虽然可以指定已经存在的窗口，但是不等于可以任意控制其他窗口。为了防止被不相干的窗口控制，浏览器只有在两个窗口同源，或者目标窗口被当前网页打开的情况下，才允许<code class="highlighter-rouge">open</code>方法指向该窗口。</p>

<p><code class="highlighter-rouge">open</code>方法返回新窗口的引用。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">windowB</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'windowB.html'</span><span class="p">,</span> <span class="s1">'WindowB'</span><span class="p">);</span>
<span class="nx">windowB</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">name</span> <span class="c1">// "WindowB"</span>
</code></pre></div></div>

<p>下面是另一个例子。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
<span class="nx">w</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s1">'已经打开新窗口'</span><span class="p">);</span>
<span class="nx">w</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s1">'http://example.com'</span><span class="p">;</span>
</code></pre></div></div>

<p>上面代码先打开一个新窗口，然后在该窗口弹出一个对话框，再将网址导向<code class="highlighter-rouge">example.com</code>。</p>

<p>由于<code class="highlighter-rouge">open</code>这个方法很容易被滥用，许多浏览器默认都不允许脚本自动新建窗口。只允许在用户点击链接或按钮，脚本做出反应，弹出新窗口。因此，有必要检查一下打开新窗口是否成功。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">popup</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 新建窗口失败</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">window.close</code>方法用于关闭当前窗口，一般用来关闭<code class="highlighter-rouge">window.open</code>方法新建的窗口。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">popup</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</code></pre></div></div>

<p>该方法只对顶层窗口有效，<code class="highlighter-rouge">iframe</code>框架之中的窗口使用该方法无效。</p>

<h3 id="windowprint">window.print()</h3>

<p><code class="highlighter-rouge">print</code>方法会跳出打印对话框，同用户点击菜单里面的“打印”命令效果相同。</p>

<p>页面上的打印按钮代码如下。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'printLink'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="err">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">print</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>非桌面设备（比如手机）可能没有打印功能，这时可以这样判断。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span><span class="p">.</span><span class="nx">print</span> <span class="o">===</span> <span class="s1">'function'</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 支持打印功能</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="windowgetcomputedstyle">window.getComputedStyle()</h3>

<p><code class="highlighter-rouge">getComputedStyle</code>方法接受一个HTML元素作为参数，返回一个包含该HTML元素的最终样式信息的对象。详见《DOM》一章的CSS章节。</p>

<h3 id="windowmatchmedia">window.matchMedia()</h3>

<p><code class="highlighter-rouge">window.matchMedia</code>方法用来检查CSS的mediaQuery语句。详见《DOM》一章的CSS章节。</p>

<h3 id="windowfocus">window.focus()</h3>

<p><code class="highlighter-rouge">focus</code>方法会激活指定当前窗口，使其获得焦点。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">popup</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'popup.html'</span><span class="p">,</span> <span class="s1">'Popup Window'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">((</span><span class="nx">popup</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">popup</span><span class="p">.</span><span class="nx">closed</span><span class="p">)</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">popup</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码先检查<code class="highlighter-rouge">popup</code>窗口是否依然存在，确认后激活该窗口。</p>

<p>当前窗口获得焦点时，会触发<code class="highlighter-rouge">focus</code>事件；当前窗口失去焦点时，会触发<code class="highlighter-rouge">blur</code>事件。</p>

<h3 id="windowgetselection">window.getSelection()</h3>

<p><code class="highlighter-rouge">window.getSelection</code>方法返回一个<code class="highlighter-rouge">Selection</code>对象，表示用户现在选中的文本。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">selObj</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">();</span>
</code></pre></div></div>

<p>使用<code class="highlighter-rouge">Selction</code>对象的<code class="highlighter-rouge">toString</code>方法可以得到选中的文本。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">selectedText</span> <span class="o">=</span> <span class="nx">selObj</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="多窗口操作">多窗口操作</h2>

<p>由于网页可以使用<code class="highlighter-rouge">iframe</code>元素，嵌入其他网页，因此一个网页之中会形成多个窗口。另一情况是，子网页之中又嵌入别的网页，形成多级窗口。</p>

<h3 id="窗口的引用">窗口的引用</h3>

<p>各个窗口之中的脚本，可以引用其他窗口。浏览器提供了一些特殊变量，用来返回其他窗口。</p>

<ul>
  <li><code class="highlighter-rouge">top</code>：顶层窗口，即最上层的那个窗口</li>
  <li><code class="highlighter-rouge">parent</code>：父窗口</li>
  <li><code class="highlighter-rouge">self</code>：当前窗口，即自身</li>
</ul>

<p>下面代码可以判断，当前窗口是否为顶层窗口。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">top</span> <span class="o">===</span> <span class="nb">self</span>

<span class="c1">// 更好的写法</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">top</span> <span class="o">===</span> <span class="nb">window</span><span class="p">.</span><span class="nb">self</span>
</code></pre></div></div>

<p>下面的代码让父窗口的访问历史后退一次。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">parent</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
</code></pre></div></div>

<p>与这些变量对应，浏览器还提供一些特殊的窗口名，供<code class="highlighter-rouge">open</code>方法、<code class="highlighter-rouge">&lt;a&gt;</code>标签、<code class="highlighter-rouge">&lt;form&gt;</code>标签等引用。</p>

<ul>
  <li><code class="highlighter-rouge">_top</code>：顶层窗口</li>
  <li><code class="highlighter-rouge">_parent</code>：父窗口</li>
  <li><code class="highlighter-rouge">_blank</code>：新窗口</li>
</ul>

<p>下面代码就表示在顶层窗口打开链接。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"somepage.html"</span> <span class="na">target=</span><span class="s">"_top"</span><span class="nt">&gt;</span>Link<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>

<h3 id="iframe标签">iframe标签</h3>

<p>对于<code class="highlighter-rouge">iframe</code>嵌入的窗口，<code class="highlighter-rouge">document.getElementById</code>方法可以拿到该窗口的DOM节点，然后使用<code class="highlighter-rouge">contentWindow</code>属性获得<code class="highlighter-rouge">iframe</code>节点包含的<code class="highlighter-rouge">window</code>对象，或者使用<code class="highlighter-rouge">contentDocument</code>属性获得包含的<code class="highlighter-rouge">document</code>对象。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">frame</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'theFrame'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">frameWindow</span> <span class="o">=</span> <span class="nx">frame</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">;</span>

<span class="c1">// 等同于 frame.contentWindow.document</span>
<span class="kd">var</span> <span class="nx">frameDoc</span> <span class="o">=</span> <span class="nx">frame</span><span class="p">.</span><span class="nx">contentDocument</span><span class="p">;</span>

<span class="c1">// 获取子窗口的变量和属性</span>
<span class="nx">frameWindow</span><span class="p">.</span><span class="kd">function</span><span class="p">()</span>

<span class="c1">// 获取子窗口的标题</span>
<span class="nx">frameWindow</span><span class="p">.</span><span class="nx">title</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">iframe</code>元素遵守同源政策，只有当父页面与框架页面来自同一个域名，两者之间才可以用脚本通信，否则只有使用<code class="highlighter-rouge">window.postMessage</code>方法。</p>

<p><code class="highlighter-rouge">iframe</code>窗口内部，使用<code class="highlighter-rouge">window.parent</code>引用父窗口。如果当前页面没有父窗口，则<code class="highlighter-rouge">window.parent</code>属性返回自身。因此，可以通过<code class="highlighter-rouge">window.parent</code>是否等于<code class="highlighter-rouge">window.self</code>，判断当前窗口是否为<code class="highlighter-rouge">iframe</code>窗口。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">parent</span> <span class="o">!==</span> <span class="nb">window</span><span class="p">.</span><span class="nb">self</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 当前窗口是子窗口</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">iframe</code>嵌入窗口的<code class="highlighter-rouge">window</code>对象，有一个<code class="highlighter-rouge">frameElement</code>属性，返回它在父窗口中的DOM节点。对于那么非嵌入的窗口，该属性等于<code class="highlighter-rouge">null</code>。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">f1Element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'f1'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fiWindow</span> <span class="o">=</span> <span class="nx">f1Element</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">;</span>
<span class="nx">f1Window</span><span class="p">.</span><span class="nx">frameElement</span> <span class="o">===</span> <span class="nx">f1Element</span> <span class="c1">// true</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">frameElement</span> <span class="o">===</span> <span class="kc">null</span> <span class="c1">// true</span>
</code></pre></div></div>

<h3 id="frames属性">frames属性</h3>

<p><code class="highlighter-rouge">window</code>对象的<code class="highlighter-rouge">frames</code>属性返回一个类似数组的对象，成员是所有子窗口的<code class="highlighter-rouge">window</code>对象。可以使用这个属性，实现窗口之间的互相引用。比如，<code class="highlighter-rouge">frames[0]</code>返回第一个子窗口，<code class="highlighter-rouge">frames[1].frames[2]</code>返回第二个子窗口内部的第三个子窗口，<code class="highlighter-rouge">parent.frames[1]</code>返回父窗口的第二个子窗口。</p>

<p>需要注意的是，<code class="highlighter-rouge">window.frames</code>每个成员的值，是框架内的窗口（即框架的<code class="highlighter-rouge">window</code>对象），而不是<code class="highlighter-rouge">iframe</code>标签在父窗口的DOM节点。如果要获取每个框架内部的DOM树，需要使用<code class="highlighter-rouge">window.frames[0].document</code>的写法。</p>

<p>另外，如果<code class="highlighter-rouge">iframe</code>元素设置了<code class="highlighter-rouge">name</code>或<code class="highlighter-rouge">id</code>属性，那么属性值会自动成为全局变量，并且可以通过<code class="highlighter-rouge">window.frames</code>属性引用，返回子窗口的<code class="highlighter-rouge">window</code>对象。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML代码为&lt;iframe id="myFrame"&gt;</span>
<span class="nx">myFrame</span> <span class="c1">// [HTMLIFrameElement]</span>
<span class="nx">frames</span><span class="p">.</span><span class="nx">myframe</span> <span class="o">===</span> <span class="nx">myFrame</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>另外，<code class="highlighter-rouge">name</code>属性的值会自动成为子窗口的名称，可以用在<code class="highlighter-rouge">window.open</code>方法的第二个参数，或者<code class="highlighter-rouge">&lt;a&gt;</code>和<code class="highlighter-rouge">&lt;frame&gt;</code>标签的<code class="highlighter-rouge">target</code>属性。</p>

<h2 id="事件">事件</h2>

<p><code class="highlighter-rouge">window</code>对象可以接收以下事件。</p>

<h3 id="load事件和onload属性">load事件和onload属性</h3>

<p><code class="highlighter-rouge">load</code>事件发生在文档在浏览器窗口加载完毕时。<code class="highlighter-rouge">window.onload</code>属性可以指定这个事件的回调函数。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">'example'</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">elt</span> <span class="o">=</span> <span class="nx">elements</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<p>上面代码在网页加载完毕后，获取指定元素并进行处理。</p>

<h3 id="error-事件和-onerror-属性">error 事件和 onerror 属性</h3>

<p>浏览器脚本发生错误时，会触发<code class="highlighter-rouge">window</code>对象的<code class="highlighter-rouge">error</code>事件。我们可以通过<code class="highlighter-rouge">window.onerror</code>属性对该事件指定回调函数。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">lineno</span><span class="p">,</span> <span class="nx">colno</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"出错了！--&gt; %s"</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>由于历史原因，<code class="highlighter-rouge">window</code>的<code class="highlighter-rouge">error</code>事件的回调函数不接受错误对象作为参数，而是一共可以接受五个参数，它们的含义依次如下。</p>

<ul>
  <li>出错信息</li>
  <li>出错脚本的网址</li>
  <li>行号</li>
  <li>列号</li>
  <li>错误对象</li>
</ul>

<p>老式浏览器只支持前三个参数。</p>

<p>并不是所有的错误，都会触发 JavaScript 的<code class="highlighter-rouge">error</code>事件（即让 JavaScript 报错）。一般来说，只有 JavaScript 脚本的错误，才会触发这个事件，而像资源文件不存在之类的错误，都不会触发。</p>

<p>下面是一个例子，如果整个页面未捕获错误超过3个，就显示警告。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">onerror</span><span class="p">.</span><span class="nx">num</span><span class="o">++</span> <span class="o">&gt;</span> <span class="nx">onerror</span><span class="p">.</span><span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">'ERROR: '</span> <span class="o">+</span> <span class="nx">msg</span> <span class="o">+</span> <span class="s1">'</span><span class="err">\</span><span class="s1">n'</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">':'</span> <span class="o">+</span> <span class="nx">line</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">onerror</span><span class="p">.</span><span class="nx">max</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nx">onerror</span><span class="p">.</span><span class="nx">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div></div>

<p>需要注意的是，如果脚本网址与网页网址不在同一个域（比如使用了CDN），浏览器根本不会提供详细的出错信息，只会提示出错，错误类型是“Script error.”，行号为0，其他信息都没有。这是浏览器防止向外部脚本泄漏信息。一个解决方法是在脚本所在的服务器，设置<code class="highlighter-rouge">Access-Control-Allow-Origin</code>的HTTP头信息。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Access-Control-Allow-Origin: <span class="k">*</span>
</code></pre></div></div>

<p>然后，在网页的<code class="highlighter-rouge">&lt;script&gt;</code>标签中设置<code class="highlighter-rouge">crossorigin</code>属性。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">crossorigin=</span><span class="s">"anonymous"</span> <span class="na">src=</span><span class="s">"//example.com/file.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div></div>

<p>上面代码的<code class="highlighter-rouge">crossorigin="anonymous"</code>表示，读取文件不需要身份信息，即不需要cookie和HTTP认证信息。如果设为<code class="highlighter-rouge">crossorigin="use-credentials"</code>，就表示浏览器会上传cookie和HTTP认证信息，同时还需要服务器端打开HTTP头信息<code class="highlighter-rouge">Access-Control-Allow-Credentials</code>。</p>

<h2 id="url的编码解码方法">URL的编码/解码方法</h2>

<p>网页URL的合法字符分成两类。</p>

<ul>
  <li>URL元字符：分号（<code class="highlighter-rouge">;</code>），逗号（’,’），斜杠（<code class="highlighter-rouge">/</code>），问号（<code class="highlighter-rouge">?</code>），冒号（<code class="highlighter-rouge">:</code>），at（<code class="highlighter-rouge">@</code>），<code class="highlighter-rouge">&amp;</code>，等号（<code class="highlighter-rouge">=</code>），加号（<code class="highlighter-rouge">+</code>），美元符号（<code class="highlighter-rouge">$</code>），井号（<code class="highlighter-rouge">#</code>）</li>
  <li>语义字符：<code class="highlighter-rouge">a-z</code>，<code class="highlighter-rouge">A-Z</code>，<code class="highlighter-rouge">0-9</code>，连词号（<code class="highlighter-rouge">-</code>），下划线（<code class="highlighter-rouge">_</code>），点（<code class="highlighter-rouge">.</code>），感叹号（<code class="highlighter-rouge">!</code>），波浪线（<code class="highlighter-rouge">~</code>），星号（<code class="highlighter-rouge">*</code>），单引号（<code class="highlighter-rouge">\</code><code class="highlighter-rouge">），圆括号（</code>()`）</li>
</ul>

<p>除了以上字符，其他字符出现在URL之中都必须转义，规则是根据操作系统的默认编码，将每个字节转为百分号（<code class="highlighter-rouge">%</code>）加上两个大写的十六进制字母。比如，UTF-8的操作系统上，<code class="highlighter-rouge">http://www.example.com/q=春节</code>这个URL之中，汉字“春节”不是URL的合法字符，所以被浏览器自动转成<code class="highlighter-rouge">http://www.example.com/q=%E6%98%A5%E8%8A%82</code>。其中，“春”转成了<code class="highlighter-rouge">%E6%98%A5</code>，“节”转成了“%E8%8A%82”。这是因为“春”和”节“的UTF-8编码分别是<code class="highlighter-rouge">E6 98 A5</code>和<code class="highlighter-rouge">E8 8A 82</code>，将每个字节前面加上百分号，就构成了URL编码。</p>

<p>JavaScript提供四个URL的编码/解码方法。</p>

<ul>
  <li><code class="highlighter-rouge">encodeURI()</code></li>
  <li><code class="highlighter-rouge">encodeURIComponent()</code></li>
  <li><code class="highlighter-rouge">decodeURI()</code></li>
  <li><code class="highlighter-rouge">decodeURIComponent()</code></li>
</ul>

<h3 id="encodeuri">encodeURI</h3>

<p><code class="highlighter-rouge">encodeURI</code> 方法的参数是一个字符串，代表整个URL。它会将元字符和语义字符之外的字符，都进行转义。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">encodeURI</span><span class="p">(</span><span class="s1">'http://www.example.com/q=春节'</span><span class="p">)</span>
<span class="c1">// "http://www.example.com/q=%E6%98%A5%E8%8A%82"</span>
</code></pre></div></div>

<h3 id="encodeuricomponent">encodeURIComponent</h3>

<p><code class="highlighter-rouge">encodeURIComponent</code>只转除了语义字符之外的字符，元字符也会被转义。因此，它的参数通常是URL的路径或参数值，而不是整个URL。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="s1">'春节'</span><span class="p">)</span>
<span class="c1">// "%E6%98%A5%E8%8A%82"</span>
<span class="nb">encodeURIComponent</span><span class="p">(</span><span class="s1">'http://www.example.com/q=春节'</span><span class="p">)</span>
<span class="c1">// "http%3A%2F%2Fwww.example.com%2Fq%3D%E6%98%A5%E8%8A%82"</span>
</code></pre></div></div>

<p>上面代码中，<code class="highlighter-rouge">encodeURIComponent</code>会连URL元字符一起转义，所以通常只用它转URL的片段。</p>

<h3 id="decodeuri">decodeURI</h3>

<p><code class="highlighter-rouge">decodeURI</code>用于还原转义后的URL。它是<code class="highlighter-rouge">encodeURI</code>方法的逆运算。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">decodeURI</span><span class="p">(</span><span class="s1">'http://www.example.com/q=%E6%98%A5%E8%8A%82'</span><span class="p">)</span>
<span class="c1">// "http://www.example.com/q=春节"</span>
</code></pre></div></div>

<h3 id="decodeuricomponent">decodeURIComponent</h3>

<p><code class="highlighter-rouge">decodeURIComponent</code>用于还原转义后的URL片段。它是<code class="highlighter-rouge">encodeURIComponent</code>方法的逆运算。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="s1">'%E6%98%A5%E8%8A%82'</span><span class="p">)</span>
<span class="c1">// "春节"</span>
</code></pre></div></div>

<h2 id="alertpromptconfirm">alert()，prompt()，confirm()</h2>

<p><code class="highlighter-rouge">alert()</code>、<code class="highlighter-rouge">prompt()</code>、<code class="highlighter-rouge">confirm()</code>都是浏览器与用户互动的全局方法。它们会弹出不同的对话框，要求用户做出回应。</p>

<p>需要注意的是，<code class="highlighter-rouge">alert()</code>、<code class="highlighter-rouge">prompt()</code>、<code class="highlighter-rouge">confirm()</code>这三个方法弹出的对话框，都是浏览器统一规定的式样，是无法定制的。</p>

<p><code class="highlighter-rouge">alert</code>方法弹出的对话框，只有一个“确定”按钮，往往用来通知用户某些信息。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 格式</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>

<span class="c1">// 实例</span>
<span class="nx">alert</span><span class="p">(</span><span class="s1">'Hello World'</span><span class="p">);</span>
</code></pre></div></div>

<p>用户只有点击“确定”按钮，对话框才会消失。在对话框弹出期间，浏览器窗口处于冻结状态，如果不点“确定”按钮，用户什么也干不了。</p>

<p><code class="highlighter-rouge">alert</code>方法的参数只能是字符串，没法使用CSS样式，但是可以用<code class="highlighter-rouge">\n</code>指定换行。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">alert</span><span class="p">(</span><span class="s1">'本条提示</span><span class="err">\</span><span class="s1">n分成两行'</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">prompt</code>方法弹出的对话框，在提示文字的下方，还有一个输入框，要求用户输入信息，并有“确定”和“取消”两个按钮。它往往用来获取用户输入的数据。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 格式</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">prompt</span><span class="p">(</span><span class="nx">text</span><span class="p">[,</span> <span class="k">default</span><span class="p">]);</span>

<span class="c1">// 实例</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">prompt</span><span class="p">(</span><span class="s1">'您的年龄？'</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码会跳出一个对话框，文字提示为“您的年龄？”，要求用户在对话框中输入自己的年龄（默认显示25）。</p>

<p><code class="highlighter-rouge">prompt</code>方法的返回值是一个字符串（有可能为空）或者<code class="highlighter-rouge">null</code>，具体分成三种情况。</p>

<ol>
  <li>用户输入信息，并点击“确定”，则用户输入的信息就是返回值。</li>
  <li>用户没有输入信息，直接点击“确定”，则输入框的默认值就是返回值。</li>
  <li>用户点击了“取消”（或者按了Esc按钮），则返回值是<code class="highlighter-rouge">null</code>。</li>
</ol>

<p><code class="highlighter-rouge">prompt</code>方法的第二个参数是可选的，但是如果不提供的话，IE浏览器会在输入框中显示<code class="highlighter-rouge">undefined</code>。因此，最好总是提供第二个参数，作为输入框的默认值。</p>

<p><code class="highlighter-rouge">confirm</code>方法弹出的对话框，除了提示信息之外，只有“确定”和“取消”两个按钮，往往用来征询用户的意见。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 格式</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">confirm</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>

<span class="c1">// 实例</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">confirm</span><span class="p">(</span><span class="s2">"你最近好吗？"</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码弹出一个对话框，上面只有一行文字“你最近好吗？”，用户选择点击“确定”或“取消”。</p>

<p><code class="highlighter-rouge">confirm</code>方法返回一个布尔值，如果用户点击“确定”，则返回<code class="highlighter-rouge">true</code>；如果用户点击“取消”，则返回<code class="highlighter-rouge">false</code>。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">okay</span> <span class="o">=</span> <span class="nx">confirm</span><span class="p">(</span><span class="s1">'Please confirm this message.'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">okay</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 用户按下“确定”</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// 用户按下“取消”</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">confirm</code>的一个用途是，当用户离开当前页面时，弹出一个对话框，问用户是否真的要离开。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">onunload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">confirm</span><span class="p">(</span><span class="s1">'你确定要离开当面页面吗？'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>这三个方法都具有堵塞效应，一旦弹出对话框，整个页面就是暂停执行，等待用户做出反应。</p>

<h2 id="参考链接">参考链接</h2>

<ul>
  <li>Karl Dubost, <a href="https://hacks.mozilla.org/2013/09/user-agent-detection-history-and-checklist/">User-Agent detection, history and checklist</a></li>
  <li>Conrad Irwin, <a href="https://bugsnag.com/blog/js-stacktraces/">JS stacktraces. The good, the bad, and the ugly</a></li>
  <li>Daniel Lee, <a href="http://danlimerick.wordpress.com/2014/01/18/how-to-catch-javascript-errors-with-window-onerror-even-on-chrome-and-firefox/">How to catch JavaScript Errors with window.onerror (even on Chrome and Firefox)</a></li>
</ul>


</article>

<div class="row">
<div class="twelve columns">

<h2>留言</h2>

<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'jstutorial'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</section>

</div>
</div>

<footer>
<div class="row">
<div class="twelve columns">
	<p><a href="/introduction/license.html">版权声明</a> | last modified on 2014-01-12 </p>
</div>
</div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43771063-1', 'ruanyifeng.com');
  ga('send', 'pageview');
</script>
</body>
</html>


